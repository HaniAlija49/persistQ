{
  "service": "cron-job.org",
  "description": "External cron service configuration for PersistQ backend",
  "setup_url": "https://cron-job.org/en/",
  "jobs": [
    {
      "name": "PersistQ - Model Warming",
      "url": "https://api.persistq.com/api/warm",
      "schedule": "*/5 * * * *",
      "schedule_description": "Every 5 minutes",
      "method": "GET",
      "headers": {
        "Authorization": "Bearer ${CRON_SECRET}"
      },
      "timeout": 30,
      "enabled": true,
      "notification": {
        "on_failure": true,
        "email": "your-email@example.com"
      },
      "notes": "Keeps the ML embedding model warm in memory to avoid cold start delays. Critical for performance."
    },
    {
      "name": "PersistQ - Cleanup Webhooks",
      "url": "https://api.persistq.com/api/cron/cleanup-webhooks",
      "schedule": "0 2 * * *",
      "schedule_description": "Daily at 2:00 AM UTC",
      "method": "GET",
      "headers": {
        "Authorization": "Bearer ${CRON_SECRET}"
      },
      "timeout": 60,
      "enabled": true,
      "notification": {
        "on_failure": true,
        "email": "your-email@example.com"
      },
      "notes": "Deletes expired webhook events to prevent database bloat."
    },
    {
      "name": "PersistQ - Expire Subscriptions",
      "url": "https://api.persistq.com/api/cron/expire-subscriptions",
      "schedule": "0 3 * * *",
      "schedule_description": "Daily at 3:00 AM UTC",
      "method": "GET",
      "headers": {
        "Authorization": "Bearer ${CRON_SECRET}"
      },
      "timeout": 120,
      "enabled": true,
      "notification": {
        "on_failure": true,
        "on_orphaned_subscriptions": true,
        "email": "your-email@example.com"
      },
      "notes": "Downgrades cancelled subscriptions that have reached their period end. Also detects orphaned subscriptions (webhook failures)."
    }
  ],
  "setup_instructions": [
    "1. Sign up at https://cron-job.org/en/signup",
    "2. Generate CRON_SECRET: openssl rand -base64 32",
    "3. Add CRON_SECRET to .env.production file",
    "4. Create each job in cron-job.org dashboard with the configuration above",
    "5. Replace 'api.persistq.com' with your actual domain",
    "6. Replace '${CRON_SECRET}' with your actual secret",
    "7. Replace 'your-email@example.com' with your email",
    "8. Test each endpoint manually first before enabling",
    "9. Monitor execution history for failures"
  ],
  "testing": {
    "model_warming": "curl -H 'Authorization: Bearer YOUR_SECRET' https://api.persistq.com/api/warm",
    "cleanup_webhooks": "curl -H 'Authorization: Bearer YOUR_SECRET' https://api.persistq.com/api/cron/cleanup-webhooks",
    "expire_subscriptions": "curl -H 'Authorization: Bearer YOUR_SECRET' https://api.persistq.com/api/cron/expire-subscriptions"
  },
  "monitoring": {
    "cron_job_org": "Built-in execution history and failure notifications",
    "backend_logs": "docker compose -f deployment/docker-compose.yml logs -f backend",
    "health_check": "curl https://api.persistq.com/api/status"
  }
}
